# Mini Shell

유닉스 프로그래밍 수업 과제로 파이프, 리다이렉션 기능을 가진 미니 쉘을 구현하였습니다.

## 설계

기존 방법을 그대로 따르면 파이프 / 리다이렉션이 두 개 이상 되는 경우를 다루기가 힘듭니다.
그래서 입력된 문자열을 순차적으로 처리하지 않고, 부분적으로 나누어 처리하는 방법을 택했습니다.

### Parser

먼저 그렇게 처리하기 위해, parser라는 함수를 사용합니다.

- 매개변수로 `input`, `stdin`, `stdout`을 받는다.

- `input`은 `ls|grep txt>out.txt`처럼 shell에서 실행할 수 있는 문자열이다.
- 이 함수는 내부적으로 새로운 자식 프로세스를 생성하는데, `stdin`, `stdout`은 그 자식 프로세스의 `stdin`, `stdout`이 된다.
- 반환값은 자식 프로세스의 pid다.

이 함수는 다음과 같이 동작합니다.

- input에서 `|`, `&`, `;`, `>` 등 두 개 이상의 프로그램을 실행시키도록 하는 연산자를 딱 하나만 찾는다.

  - 만약 연산자가 여러 개 있다면, 우선순위는 `;`>`&`,`|`>`>`,`<`이다.

  - 만약 같은 우선순위의 연산자가 여러 개 있으면 가장 나중에 나오는 연산자를 선택한다.
  - 이렇게 선택한 연산자를 기준으로 문자열을 두 부분으로 나눈다.
  - `|`, `&`, `;`의 경우, 나눈 두 부분을 각각 parser로 호출한다. 예를 들어 `parse("ls|grep txt>out.txt",~~,~~)`는 내부적으로 `parse("ls",~~,~~)`, `parse("grep txt>out.txt",~~,~~)`가 호출된다.
  - `>`,`<`의 경우 파일을 여는 자식 프로세스를 생성한 후 호출된다.
  - 그리고 이 두 프로세스를 적절히 파이프로 연결한다.

- 만약 연산자가 전혀 없다면, 단일하게 실행할 수 있는 프로그램으로 판단하고 `execvp`함수를 사용하여 실행한다.

### main

`main`함수에서는 무한 루프를 돌면서 다음 과정을 반복한다.

1. `msh # `과 같은 쉘 기호를 표시한다.
1. `fgets`함수를 호출하여 사용자 입력을 읽는다.
1. `cd`, `exit`등 쉘 내장 함수인지 판별하여 실행한다.
1. 쉘 내장 함수가 아닐 경우 `parser`함수를 호출한다.
